# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Commands

### Development

An instance of the service is already started, you don't need to start it

- `yarn dev` - Start development server on port 3000
- `yarn build` - Build production application
- `yarn migrate:latest` - Run database migrations
- `yarn lint:fix` - Fix all auto-fixable errors (such as formatting)

## Project Architecture

This is a React application built with **TanStack Start** (React-based full-stack framework) using:

### Core Technologies
- **TanStack Router** - File-based routing system with type-safe routes
- **Kysely** - Type-safe SQL query builder for PostgreSQL 
- **Vite** - Build tool and development server
- **TypeScript** - Type safety throughout
- **Tailwind CSS** - Styling framework
- **PostgreSQL** - Database backend

### Project Structure
- `src/app/routes/` - File-based routes (TanStack Router convention)
- `src/server/data/` - Database layer with Kysely setup and repository pattern
  - `src/server/data/index.ts` - Database connection and configuration
  - `src/server/data/repo/` - Repository pattern for data access (user, project, project-wording)
  - `src/server/data/*.types.ts` - Type definitions for database schemas and entities
- `src/server/common/env/` - Environment variable configuration
- `src/server/common/authorization` - Contains all rbac predicate functions
- `src/app/common/lib/utils.ts` - Shared utility functions
- `src/app/features` - Contain features slices
  - any hooks should be a file prefixed with `use-`
  - any feature specific component should be a file prefixed with `ui-`
- `src/router.tsx` - Router configuration and setup
- `src/routeTree.gen.ts` - Auto-generated route tree (do not edit manually)
- `src/server-functions` - Contains all server functions

### Database Architecture
The application uses a **repository pattern** for data access with these main entities:
- **Users** - User management
- **Projects** - Project entities  
- **Project Wordings** - Localization/translation management (the core feature)

Database migrations are stored in `.config/migrations/` and managed with Kysely CLI.

If you need to implement a new repo, check user as an exemple

### Development Setup
- Uses Yarn 4.x with Berry package manager
- ESLint + Prettier for code formatting
- TypeScript path mapping (`@/*` â†’ `./src/*`)
- Development server runs on port 3000
- Docker Compose setup available for local development

## Key Patterns

### Route Generation
TanStack Router automatically generates `src/routeTree.gen.ts` based on files in `src/app/routes/`. Do not edit this file manually.

### Database Queries
Use the repository pattern in `src/server/data/repo/` for database operations. All repositories use Kysely for type-safe queries against the PostgreSQL database.

### Styling
The project uses Tailwind CSS with additional animation utilities via `tw-animate-css`.

### Api calls

When the app need to do a query, use react-query

## Instructions

- Once you are done doing a batch of editing, run `yarn lint:fix`
- All db query should be put in corresponding repo methods
- When possible use components from shadcn, you can install new one as needed
- Any server functions should be prefixed with `server`
- Avoid unneccessarily exporting values, for instance avoid exporting a props interface for components, when needed simply use a ComponentProps to extract a component props type
- Avoid creating barrels files